<!DOCTYPE html>
<!--
Created using JS Bin
http://jsbin.com
Copyright (c) 2017 by teak1 (http://jsbin.com/zapubod/5/edit)
Released under the MIT license: http://jsbin.mit-license.org
-->
<meta name="robots" content="noindex">
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>JS Bin</title>
<style id="jsbin-css">
canvas{
  border:0px solid black;
}
</style>
</head>
<body>
  <h3>image color thing</h3>
  <div id=test hidden></div>
  <input type=number id=thr value=100 />inverse:<select id="inverse" value="off"><option value="on">on</option><option value="off">off</option></select><button onClick="start();">start</button><input type="file" name="filename" accept="image/jpeg, image/png" onchange="readURL(this);">mode:<select id="modeSel"><option value=1>B&W</option><option value=2>ColorW/Outline</option></select><span id=debug></span><br/>
  <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHQAAABNCAMAAABAMbBwAAAAw1BMVEUQLoL///+/LDT20EcAJH57fqkALoX30kfGLC3DLDC+JjTBLDJbLW8ALoP510gALoe8GzPCOjW+IyzgmD/zyEa6ABLQazo3LnrFRDa7Dhz46+y6AAvKWDjIUzfszc69HSfHUlbluLnfpaf2zjvvvkXhrLH79fXMXzn//ezWiYz6563Ob3PrtUPJW1/31WPx29zFR03VfDzTdDpoLWmgLExJLna2LDsoLn6MLViqLER5LWLRaGndkD6VLVN8Z5PHJiX43YWDLfChAAACCUlEQVRoge3Y2VLCMBQG4NhqujcBioCKiAqI4Moibuj7P5VtwZouKdZJe2ac/Jdc5JuTpSQHIRkZGRmZAnEcp1oPE4KeWq0nhxBcCY0xslfPlh7Gel7ZwS8lk2g213XDUraxDN2Y26WyGL8oegRGsL58IWWxDpllkBvWskkpi4vRPJvcsHNUQrF4oRg8MoihtISrZMYv87tYW7Dqm/lkEN0mIk1sf+w2A1VgrXiRu5w/M2y0xO1hZ7ljPSN1WXCC9/l5TxdqBkmrxipnmHTQATfr5IKalNZGh4ejGqVJtbfmj5MO2uPmtR4fmNbePM31o3lvSoKtT/jjpMNHTzvxMpWG66rbuG4jMcvHd0LQSaxQ2vUiMmS9NqtazVcR6NFxrM4TV1Nj0bRupPY6Z/0CJh8977FmW0uYvqrWQtXq1MdF5jYPvWfPKL1Mmb46pYrVa973h8VIPjpssuaDmzb9dX3sKEWLzEVje5d6GYX6pV4OCheZiw6YJTVHmYWq6sXVn0wuOmZQ2uCh12JR9pTSaebs+uinWPSGQc2svRvmVjDKnBjT45iaaBSiUpA1Bdm9IOcU5IsE8u0F+ZeB+T8FuTmA3JFgboNl3ntBbvggbxmQV1tOQN6nIC9xmJ4DTHcFpo/0i45ZKX26/N5gaY1fgC5oyFbf7w3Z6jvbYarv4f/Q1XIyMjIy/zFfLHlJQQeEcPAAAAAASUVORK5CYII=" id="blah"></img>
  <span id=er></span>
  <script id="jsbin-javascript">
       function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById("blah").src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
var img,w,h,can,ctx,can2,ct,x,y,thr,inv;
function start(){
  inv=document.getElementById("inverse").value;
  can2 = null;
  img = document.getElementsByTagName("img")[0];
//img.width = img.width>500?500:img.width;
//img.height = img.height>500?500:img.height;
w = img.width;
h = img.height;
  document.getElementById("er").innerHTML="";
document.getElementById("test").innerHTML="";
can = document.createElement("canvas");
can.setAttribute("width",w);
can.setAttribute("height",h);
//document.body.appendChild(document.createElement("br"));
document.getElementById("er").appendChild(can);
ctx = document.getElementsByTagName("canvas")[0].getContext("2d");
ctx.fillStyle="black";
ctx.fillRect(0,0,w,h);
can2 = document.createElement("canvas");
can2.setAttribute("width",w);
can2.setAttribute("height",h);
document.getElementById("test").appendChild(can2);
ct = can2.getContext("2d");
ct.drawImage(img,0,0);
x = 0;
y = 1;
thr =100;
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  loop();
  
}
function dif(n,m){
  var num1 = Math.sqrt(n*n);
  var num2 = Math.sqrt(m*m);
  var num3 = num1-num2;
  return Math.sqrt(num3*num3);
}
function loop(){
  try{
  thr = Number(document.getElementById("thr").value);
  if(y<=h)window.requestAnimationFrame(loop);
  for(var i = 0;i<50;i++){
  x++;
  var data = ct.getImageData(x,y,3,3).data;
  var spot1 = data[0]+data[1]+data[2];
  var spot2 = data[4]+data[5]+data[6];
  var spot3 = data[8]+data[9]+data[10];
  var spot4 = data[12]+data[13]+data[14];
  var spot5 = data[16]+data[17]+data[18];
  var spot6 = data[20]+data[21]+data[22];
  var spot7 = data[24]+data[25]+data[26];
  var spot8 = data[28]+data[29]+data[30];
  var spot9 = data[32]+data[33]+data[34];
  var side1 = (spot1+spot2+spot3)/3
  var side2 = (spot1+spot4+spot7)/3
  var side3 = (spot7+spot8+spot9)/3
  var side4 = (spot3+spot6+spot9)/3
  var d1 = dif(spot5,side1);
  var d2 = dif(spot5,side2);
  var d3 = dif(spot5,side3);
  var d4 = dif(spot5,side4);
  //document.getElementById("debug").innerHTML = Math.round((y*w+x)/(w*h)*100)+"%";
  //document.getElementById("debug").innerHTML = spot1+"|"+spot2+"|"+spot3+"|"+spot4+"|"+spot5+"|"+spot6+"|"+spot7+"|"+spot8+"|"+spot9;
  //document.getElementById("debug").innerHTML = "";
  //for(var i = 0;i<36;i++){
      //document.getElementById("debug").innerHTML +=data[i]+"|";
  //}
  if(d1 > thr || d2 > thr || d3 > thr || d4 > thr){
    if(inv==="off")ctx.fillStyle="black";
    if(inv==="off")ctx.strokeStyle="black";
    if(inv==="on")ctx.fillStyle="white";
    if(inv==="on")ctx.strokeStyle="white";
  }else{
    var mode = Number(document.getElementById("ModeSel").value);
    if(inv==="off"&&mode===1)ctx.strokeStyle="white";
    if(inv==="off"&&mode===1)ctx.fillStyle="white";
    if(inv==="on"&&mode===1)ctx.fillStyle="black";
    if(inv==="on"&&mode===1)ctx.strokeStyle="black";
    if(mode===2){
      ctx.fillStyle="rgb("+data[16]+","+data[17]+","+data[18]+")";
      ctx.strokeStyle="rgb("+data[16]+","+data[17]+","+data[18]+")";
    }
  }
  ctx.fillRect(x,y,1,1);
  if(x>=w){
    x=0;
    y++;
  }
    document.getElementById("debug").innerHTML=mode+";"+x+","+y;
  }
  }catch(e){document.getElementById("debug").innerHTML=e;}
}
</script>
  <hr/>v1
</body>
</html>
